<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Edit Profile</title>
  <link rel="stylesheet" href="/styles/main.css" />
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#f4f6fc; }
    #header-container { width:100%; }
    .container { max-width:800px; margin:2rem auto; padding:0 1rem; }
    .edit-card {
      background:#fff; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.1);
      display:flex; flex-wrap:wrap; align-items:center; padding:2rem;
    }
    .edit-image { flex:1 1 150px; text-align:center; }
    .edit-image img {
      width:140px; height:140px; object-fit:cover;
      border-radius:50%; border:4px solid #6c63ff;
    }
    .edit-form { flex:2 1 300px; padding:1rem 2rem; }
    .edit-form h2 { margin-top:0; color:#333; }
    .edit-form label { display:block; margin:0.75rem 0 0.25rem; color:#555; font-weight:600; }
    .edit-form input[type='text'],
    .edit-form input[type='number'],
    .edit-form input[type='file'] {
      width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;
    }
    .edit-actions { width:100%; text-align:right; margin-top:1rem; }
    .edit-actions button {
      background:#6c63ff; color:#fff; border:none; border-radius:6px;
      padding:0.75rem 1.5rem; font-size:1rem; cursor:pointer;
      transition:background 0.3s;
    }
    .edit-actions button:hover { background:#524ae0; }
    @media(max-width:600px) {
      .edit-card { flex-direction:column; text-align:center; }
      .edit-form { padding:1rem 0; }
      .edit-actions { text-align:center; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div id="header-container"></div>
  <div class="container">
    <div class="edit-card">
      <div class="edit-image">
        <img id="previewPic" src="/images/default-avatar.png" alt="Profile Picture" />
      </div>
      <div class="edit-form">
        <h2>Edit Profile</h2>
        <form id="editForm" enctype="multipart/form-data">
          <label for="profilePic">Profile Picture</label>
          <input type="file" id="profilePic" name="profilePic" accept="image/*" />

          <label for="name">Name</label>
          <input type="text" id="name" name="name" required />

          <label for="age">Age</label>
          <input type="number" id="age" name="age" required />

          <label for="contactNumber">Contact Number</label>
          <input type="text" id="contactNumber" name="contactNumber" required />

          <label for="address">Address</label>
          <input type="text" id="address" name="address" required />
        </form>
      </div>
      <div class="edit-actions">
        <button id="saveBtn">Save Changes</button>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // Load header.html
    $("#header-container").load("/header.html");

    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token') || sessionStorage.getItem('jwtToken');
      if (!token) return window.location.href = '/login.html';

      let userID;
      try {
        const res  = await fetch('/api/profile', { headers: { 'Authorization': 'Bearer '+token }});
        const json = await res.json();
        if (!json.success) throw new Error(json.message);
        const u = json.user;
        userID = u.userID;

        // Populate
        $('#previewPic').attr('src', u.profilePic ? `/uploads/${u.profilePic}` : '/images/default-avatar.png');
        $('#name').val(u.name);
        $('#age').val(u.age);
        $('#contactNumber').val(u.contactNumber);
        $('#address').val(u.address);

      } catch (err) {
        console.error(err);
        alert('Failed to load your profile.');
        return window.location.href = '/login.html';
      }

      // Preview local
      $('#profilePic').on('change', e => {
        const file = e.target.files[0];
        if (file) $('#previewPic').attr('src', URL.createObjectURL(file));
      });

      // Save changes
      $('#saveBtn').on('click', async () => {
        const form = document.getElementById('editForm');
        const formData = new FormData(form);
        try {
          const upd = await fetch(`/api/users/${userID}`, {
            method: 'PUT', headers: { 'Authorization': 'Bearer '+token }, body: formData
          });
          if (!upd.ok) throw new Error('Update failed');
          alert('Profile updated');
          window.location.href = '/profile.html';
        } catch (e) {
          console.error(e);
          alert('Could not save changes');
        }
      });
    });
  </script>
</body>
</html>
```
