<!-- header.html -->
<div class="navbar">
  <a href="home.html" class="logo">SMART PHONES</a>
  <div class="nav-links">
    <a href="home.html">🏠 Home</a>
    <a href="cart.html">🛒 Cart <span id="cart-count">(0)</span></a>
    <a href="orderHistory.html">📦 Order History</a>
    <a href="profile.html">👤 Profile</a>

    <!-- Admin‐only links are hidden by default -->
    <a href="createproduct.html" id="createProductLink" style="display: none;">➕ Create Product</a>
    <a href="viewproduct.html"    id="viewProductsLink"  style="display: none;">📋 View Products</a>
    <a href="dashboard.html"       id="dashboardLink"     style="display: none;">📊 Dashboard</a>
    <a href="admin-users.html"     id="editUsersLink"     style="display: none;">👥 Edit Users</a>

    <button class="btn-logout">Logout</button>
  </div>
</div>

<!-- jQuery first, then your script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // 1) Logout handler
  function logoutRequest() {
    if (!confirm('Are you sure you want to logout?')) return;

    const token = localStorage.getItem('token') || sessionStorage.getItem('jwtToken');
    if (!token) {
      localStorage.clear();
      sessionStorage.clear();
      alert('You have been logged out');
      return window.location.href = '/login.html';
    }

    fetch('/api/logout', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      }
    })
    .then(res => res.ok ? res.json() : Promise.reject('Logout failed'))
    .then(data => {
      localStorage.clear();
      sessionStorage.clear();
      const name = data.user?.name || 'User';
      alert(data.success
        ? `Goodbye ${name}! You have been logged out successfully.`
        : 'You have been logged out successfully.');
      window.location.href = '/login.html';
    })
    .catch(() => {
      localStorage.clear();
      sessionStorage.clear();
      alert('Logged out (session cleared)');
      window.location.href = '/login.html';
    });
  }

  // 2) Show admin links if role=admin
  function showAdminLinks() {
    const role = localStorage.getItem('role') || sessionStorage.getItem('role');
    if (role === 'admin') {
      ['createProductLink','viewProductsLink','dashboardLink','editUsersLink']
        .forEach(id => $(`#${id}`).show());
    }
  }

  // 3) Fetch and update the cart count
  function updateCartIndicator() {
    const userID = localStorage.getItem('userID') || sessionStorage.getItem('userID');
    const token  = localStorage.getItem('token')  || sessionStorage.getItem('jwtToken');
    if (!userID || !token) {
      return $('#cart-count').text('(0)');
    }

    fetch(`/api/cart/${userID}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(data => {
      if (data.success && Array.isArray(data.items)) {
        const count = data.items.reduce((sum, i) => sum + i.quantity, 0);
        $('#cart-count').text(`(${count})`);
      }
    })
    .catch(() => $('#cart-count').text('(0)'));
  }

  // Initialize everything once the DOM is ready
  $(document).ready(() => {
    $('.btn-logout').on('click', logoutRequest);
    showAdminLinks();
    updateCartIndicator();
  });
</script>

<style>
  :root {
    --primary-start: #6c63ff;
    --primary-end:   #574ee0;
    --white:         #ffffff;
    --shadow:        rgba(0,0,0,0.1);
    --text-light:    rgba(255,255,255,0.9);
  }

  @keyframes slideDownFade {
    0% { opacity: 0; transform: translateY(-20px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(90deg, var(--primary-start), var(--primary-end));
    box-shadow: 0 2px 8px var(--shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
    animation: slideDownFade 0.5s ease-out;
  }
  .navbar .logo {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--white);
    transition: transform 0.3s;
  }
  .navbar .logo:hover {
    transform: scale(1.05);
  }

  .nav-links {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .nav-links a {
    position: relative;
    color: var(--text-light);
    text-decoration: none;
    font-weight: 500;
    padding: 0.25rem;
    transition: color 0.3s;
  }
  .nav-links a::after {
    content: '';
    position: absolute;
    left: 0; bottom: -2px;
    width: 0; height: 2px;
    background: var(--white);
    transition: width 0.3s;
  }
  .nav-links a:hover {
    color: var(--white);
  }
  .nav-links a:hover::after {
    width: 100%;
  }

  .btn-logout {
    background: transparent;
    border: 1px solid var(--white);
    color: var(--white);
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s, color 0.3s, transform 0.2s;
  }
  .btn-logout:hover {
    background: var(--white);
    color: var(--primary-end);
    transform: translateY(-2px);
  }

  @media (max-width: 600px) {
    .navbar {
      flex-direction: column;
      align-items: flex-start;
    }
    .nav-links {
      margin-top: 0.5rem;
      flex-direction: column;
      gap: 0.5rem;
      width: 100%;
    }
    .nav-links a, .btn-logout {
      width: 100%;
      text-align: left;
    }
  }
</style>
